<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Watchly - Your Personal Watchlist</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Fixed Navigation Bar -->
    <nav class="navbar">
        <div class="nav-brand">Watchly</div>
        <div class="nav-links">
            <a href="index.html" class="nav-link">Home</a>
            <a href="leaderboard.html" class="nav-link">Leaderboard</a>
            <a href="backup.html" class="nav-link">Backup</a>
            <a href="guide.html" class="nav-link">Guide</a>
        </div>
    </nav>
    
    <div class="container">
        <header>
            <h1>Watchly</h1>
            <p>Track, Organize, Discover</p>
            <button id="lockBtn" class="lock-btn"> Lock</button>
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="Search movies and shows...">
                <div class="filters">
                    <select id="statusFilter">
                        <option value="all">All Status</option>
                        <option value="watched">Watched</option>
                        <option value="upcoming">Upcoming</option>
                        <option value="pending">To Watch</option>
                    </select>
                    <select id="genreFilter">
                        <option value="all">All Genres</option>
                    </select>
                    <button id="addShowBtn" class="add-btn">+ Add Show</button>
                    <button id="exportBtn" class="add-btn">Export</button>
                    <button id="importBtn" class="add-btn">Import</button>
                    <button id="resetBtn" class="reset-btn">Reset All</button>
                    <input type="file" id="importFile" accept=".json" style="display:none;">
                </div>
            </div>
        </header>

        <main>
            <div class="stats">
                <div class="stat-item">
                    <span class="stat-number" id="totalCount">0</span>
                    <span class="stat-label">Total Items</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="watchedCount">0</span>
                    <span class="stat-label">Watched</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="upcomingCount">0</span>
                    <span class="stat-label">Upcoming</span>
                </div>
            </div>


            
            <div class="watchlist" id="watchlist"></div>
        </main>
    </div>

    <!-- Confirmation Message -->
    <div id="confirmationMsg" class="confirmation-msg"></div>

    <!-- Add Show Modal -->
    <div id="addModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Add New Show/Movie</h2>
            <form id="addForm">
                <input type="text" id="newTitle" placeholder="Title" required>
                <select id="newStatus">
                    <option value="pending">To Watch</option>
                    <option value="watched">Watched</option>
                    <option value="upcoming">Upcoming</option>
                </select>
                <input type="text" id="newGenres" placeholder="Genres (comma separated)" required>
                <input type="date" id="newDate" placeholder="Date">
                <input type="number" id="newYear" placeholder="Release Year (optional)" min="1900" max="2030">
                <input type="text" id="newNote" placeholder="Notes (optional)">
                <label><input type="checkbox" id="isMovie"> Movie</label>
                <button type="submit">Add to Watchlist</button>
            </form>
        </div>
    </div>

    <!-- Season Modal -->
    <div id="seasonModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Add Season Completion</h2>
            <p id="seasonTitle"></p>
            <input type="number" id="seasonNumber" placeholder="Season Number" min="1" required>
            <input type="date" id="seasonDate" required>
            <button id="confirmSeason">Add Season</button>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Confirm Delete</h2>
            <p id="deleteMessage">Are you sure you want to delete this item?</p>
            <div class="modal-actions">
                <button id="confirmDelete" class="delete-btn">Delete</button>
                <button id="cancelDelete" class="cancel-btn">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Reset Confirmation Modal -->
    <div id="resetModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Reset All Data</h2>
            <p>This will permanently delete ALL items from your watchlist. This action cannot be undone.</p>
            <div class="modal-actions">
                <button id="confirmReset" class="delete-btn">Reset All</button>
                <button id="cancelReset" class="cancel-btn">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Watch Status Confirmation Modal -->
    <div id="watchStatusModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Confirm Status Change</h2>
            <p id="watchStatusMessage"></p>
            <div class="modal-actions">
                <button id="confirmWatchStatus" class="delete-btn">Confirm</button>
                <button id="cancelWatchStatus" class="cancel-btn">Cancel</button>
            </div>
        </div>
    </div>



    <script>
        if (!localStorage.getItem('_auth_token')) {
            window.location.href = 'login.html';
        }
        
        // Disable dev tools only for guests, not authenticated users
        const authToken = localStorage.getItem('_auth_token');
        if (authToken && atob(authToken).includes('_guest')) {
            document.addEventListener('contextmenu', e => e.preventDefault());
            document.addEventListener('keydown', e => {
                if (e.key === 'F12' || (e.ctrlKey && e.shiftKey && e.key === 'I') || 
                    (e.ctrlKey && e.shiftKey && e.key === 'C') || (e.ctrlKey && e.key === 'u')) {
                    e.preventDefault();
                    return false;
                }
            });
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('lockBtn').addEventListener('click', function() {
                localStorage.removeItem('_auth_token');
                window.location.href = 'login.html';
            });
        });
    </script>
    <script src="script.js"></script>
</body>
</html>
